angular.module("myApp",["ui.router","ngAnimate"]).config(["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var e=function(t){var r,o,n,a,s,u,l="";for(r in t)if((o=t[r])instanceof Array)for(u=0;u<o.length;++u)a=o[u],(s={})[r+"["+u+"]"]=a,l+=e(s)+"&";else if(o instanceof Object)for(n in o)a=o[n],(s={})[r+"["+n+"]"]=a,l+=e(s)+"&";else void 0!==o&&null!==o&&(l+=encodeURIComponent(r)+"="+encodeURIComponent(o)+"&");return l.length?l.substr(0,l.length-1):l};t.defaults.transformRequest=[function(t){return angular.isObject(t)&&"[object File]"!==String(t)?e(t):t}]}]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("/",{url:"/",templateUrl:"views/index.html"}).state("register",{url:"/register",templateUrl:"views/register.html"}).state("login",{url:"/login",templateUrl:"views/login.html"}).state("list",{url:"/list",templateUrl:"views/list.html"}).state("information",{url:"/information",templateUrl:"views/information.html"}).state("information.psMsg",{views:{userInfo:{templateUrl:"views/user-info/psMsg.html"}},url:"/psMsg"}).state("information.safeSetting",{views:{userInfo:{templateUrl:"views/user-info/safeSetting.html"}},url:"/safeSetting"}).state("information.purchaseRecord",{views:{userInfo:{templateUrl:"views/user-info/purchaseRecord.html"}},url:"/purchaseRecord"}).state("information.mainPage",{views:{userInfo:{templateUrl:"views/user-info/mainPage.html"}},url:"/mainPage"})}]),angular.module("myApp").controller("indexController",["$scope","$rootScope","httpServer","urls",function(t,e,r,o){t.banner={},t.typeCur=0,t.bannerCur=0,t.type=["微电影","电视剧","话剧","电影","戏曲","书画","相声","戏剧","音乐剧"],t.hotProject=null,t.change=function(e){t.typeCur=e},t.new=null,t.unit=null,r.useHttp(o.homeUrl,"get",{},function(e){t.banner=e.data.result.slides,t.hotProject=e.data.result.hot,t.new=e.data.result.new,t.unit=e.data.result.unit})}]),angular.module("myApp").controller("infoController",["httpServer","$scope","$rootScope","urls",function(t,e,r,o){e.safeLv=["低","中","高"],e.userInfo={},e.infoCur=0,e.infoTrans=function(t){e.infoCur=t},t.useHttp(o.userInfoUrl,"post",{phone:r.userMsg.userphone},function(t){e.userInfo=t.data.result})}]),angular.module("myApp").controller("listController",["$scope","httpServer","urls","pageServer",function(t,e,r,o){t.hots=null,t.pageArr=[];var n={init:function(){t.cid=0,t.status=0,t.timeStatus=0,t.page=1,t.count=9},getData:function(){e.useHttp(r.listUrl,"get",{cid:t.cid,status:t.status,timeStatus:t.timeStatus,page:t.page,count:t.count},function(e){t.hots=e.data.result.list,t.pageNum=Math.ceil(e.data.result.countAll/t.count),t.pageArr=o.pageComponent(t.pageArr,t.page,t.pageNum,2)})}};n.init(),n.getData(),t.changeCid=function(e){t.cid!=e&&(t.cid=e,n.getData())},t.changeStatus=function(e){t.status!=e&&(t.status=e,n.getData())},t.changeTimeStatus=function(e){t.timeStatus!=e&&(t.timeStatus=e,n.getData())},t.changePage=function(e){"..."!=e&&"...."!=e&&t.page!=e&&(t.page=e,n.getData())},t.prev=function(){t.page>1&&(t.page--,n.getData())},t.next=function(){t.page<t.pageNum&&(t.page++,n.getData())},t.allType1=["全部","微电影","电视剧","话剧","电影","戏曲","书画","相声","戏剧","音乐剧"],t.allType2=["筹资中","即将结束","已成功"],t.allType3=["最新","热门","结束时间"]}]),angular.module("myApp").controller("loginController",["httpServer","$scope","$state","$rootScope","urls",function(t,e,r,o,n){e.phone="13014509731",e.psd="5769457986",e.login=function(){t.useHttp(n.loginUrl,"post",{phone:e.phone,password:e.psd},function(t){window.alert(t.data.resultMsg),"0000"==t.data.resultCode&&(o.userMsg={userLogin:!0,userphone:e.phone,userpsd:e.psd},r.go("/"))})}}]),angular.module("myApp").controller("FormController",["$scope","httpServer","$state","urls",function(t,e,r,o){t.name="",t.psdRep="",t.phone="",t.checkCode="",t.psd="",t.phoneTips="",t.psdTips="",t.checkbox=!0,t.reg=function(){e.useHttp(o.regUrl,"post",{phone:t.phone,password:t.psd,name:t.name,passwordRepeat:t.psdRep},function(e){"000004"==e.data.resultCode||"000002"==e.data.resultCode?t.phoneTips=e.data.resultMsg:(window.alert("恭喜你，注册成功！"),t.phoneTips="",t.psdTips="")})}}]),angular.module("myApp").controller("userController",["$scope","$rootScope","httpServer","urls","pageServer",function(t,e,r,o,n){t.type=["微电影","电视剧","话剧","电影","戏曲","书画","相声","戏剧","音乐剧"],t.sex="1",t.interest=[],t.settingCur=1,t.bindPhone=e.userMsg.userphone.substring(0,3)+"****"+e.userMsg.userphone.substring(7),t.settingTransform=function(e){t.settingCur=e},t.procare=[],t.prohot=[],t.recordList=[],t.payStatus=["未支付","已支付"],t.allPayStatus=["全部","未支付","已支付"],t.deletePro=!0;for(var a=0;a<t.type.length;a++)t.interest[a]=1;t.changePayStatus=function(e){t.payStatusType=e,s.getData()},t.changePage=function(e){"..."!=e&&"...."!=e&&t.recordPage!=e&&(t.recordPage=e,s.getData())},t.prev=function(){t.recordPage>1&&(t.recordPage--,s.getData())},t.next=function(){t.recordPage<t.pageCount&&(t.recordPage++,s.getData())},t.checkDelete=function(e){confirm("您确定要删除购买记录吗")&&t.recordList.splice(e,1)},r.useHttp(o.userProsUrl,"get",{},function(e){t.procare=e.data.result.procare,t.prohot=e.data.result.prohot}),t.pageArr=[];var s={init:function(){t.payStatusType=0,t.recordPage=1,t.count=6,this.getData()},getData:function(){r.useHttp(o.recordUrl,"post",{type:t.payStatusType,page:t.recordPage,count:t.count},function(e){t.recordList=e.data.result.list,t.pageCount=Math.ceil(e.data.result.count/t.count),t.pageArr=n.pageComponent(t.pageArr,t.recordPage,t.pageCount,2),console.log(t.pageArr),$(window).scrollTop(0)})}};s.init()}]),angular.module("myApp").factory("httpServer",["$http",function(t){return{useHttp:function(e,r,o,n){"get"==r?t({method:r,url:e,params:o}).then(function(t){n(t)}):"post"==r?t({method:r,url:e,data:o}).then(function(t){n(t)}):console.log("error")}}}]),angular.module("myApp").factory("pageServer",function(){return{pageComponent:function(t,e,r,o){t=[];for(var n=Math.min(r-1,e+o),a=0;a<n+1;a++)t[a]=n==r-1?a+1:a==n?"...":a+1;return e>2*o+1&&t.splice(2,e-2*o-1,"...."),t}}}),angular.module("myApp").value("urls",{homeUrl:"http://localhost:3000/IndexInfo",listUrl:"http://localhost:3000/prolist",regUrl:"http://localhost:3000/user/reg",loginUrl:"http://localhost:3000/user/login",userInfoUrl:"http://localhost:3000/user/info",userProsUrl:"http://localhost:3000/user/pros",recordUrl:"http://localhost:3000/user/RecordList"});